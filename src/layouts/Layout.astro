---
import Navbar from "../components/common/Navbar.astro";
import Footer from "../components/common/Footer.astro";
import "aos/dist/aos.css";
import "../styles/global.css";

import { VisualEditing } from "@sanity/astro/visual-editing";
import AOS from "aos";

const {
  title = "Boutee - Home",
  description = "Find your perfect handcrafted ring by connecting directly with independent UK jewellers. Boutee helps you define your style, match with makers, and bring your ideas to life.",
  ogImage = Astro.props.ogImage ? Astro.props.ogImage : "/Logo.svg" // âœ… SSR-safe fallback
} = Astro.props;

const visualEditingEnabled =
  import.meta.env.PUBLIC_SANITY_VISUAL_EDITING_ENABLED === "true";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/Logo.svg" type="image/svg+xml" />
    <meta name="generator" content={Astro.generator} />

    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Open Graph / Social Meta -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
  </head>

  <body class="flex flex-col min-h-screen scroll-smooth">
    <Navbar />

    <main class="flex-1">
      <slot />
      <VisualEditing enabled={visualEditingEnabled} />
    </main>

    <Footer />

    <!-- AOS Init -->
    <script type="module">
      document.addEventListener("DOMContentLoaded", () => {
        AOS.init({ duration: 500, once: false });
      });
    </script>
  </body>
</html>

<!-- Additional frontend scripts -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  // Spin button animation
  const initSpinButtons = () => {
    document.querySelectorAll(".spinBtn").forEach((btn) => {
      const icon = btn.querySelector(".btnIcon");
      if (!icon) return;
      btn.addEventListener("click", () => {
        icon.classList.remove("animate-spin-once");
        void icon.offsetWidth;
        icon.classList.add("animate-spin-once");
      });
    });
  };

  // Parallax effect
  const initParallax = () => {
    let ticking = false;
    const updateParallax = () => {
      document.querySelectorAll(".floating").forEach((el) => {
        const speed = parseFloat(el.dataset.speed) || 0.3;
        const offset = window.scrollY * speed * -0.4;
        el.style.setProperty("--parallaxY", `${offset}px`);
      });
      ticking = false;
    };
    window.addEventListener("scroll", () => {
      if (!ticking) {
        window.requestAnimationFrame(updateParallax);
        ticking = true;
      }
    });
  };

  // Intersection animations
  const initIntersectionAnimations = () => {
    const target = document.querySelector(".wrapper");
    if (!target) return;
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          target.classList.toggle("animate", entry.isIntersecting);
        });
      },
      { threshold: 0.3 }
    );
    observer.observe(target);
  };

  initSpinButtons();
  initParallax();
  initIntersectionAnimations();
});
</script>
